<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DAOP Phim - Xem phim online</title>
  <meta name="description" content="Xem phim online miễn phí, cập nhật nhanh.">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header class="site-header">
    <a href="/" class="site-logo">DAOP Phim</a>
    <nav class="site-nav">
      <div class="site-nav-main">
        <a href="/phim-bo.html">Phim bộ</a>
        <a href="/phim-le.html">Phim lẻ</a>
        <a href="/the-loai/">Thể loại</a>
        <a href="/quoc-gia/">Quốc gia</a>
        <a href="/danh-sach/">Danh sách</a>
        <a href="/dien-vien/">Diễn viên</a>
        <a href="/hoat-hinh.html">Hoạt hình</a>
        <a href="/shows.html">TV Shows</a>
        <a href="/gioi-thieu.html">Giới thiệu</a>
        <a href="/donate.html">Donate</a>
      </div>
      <div class="site-nav-actions">
        <a href="/tim-kiem.html">Tìm kiếm</a>
        <a href="/login.html">Đăng nhập</a>
      </div>
    </nav>
  </header>
  <main class="container">
    <div id="slider-wrap" class="slider-wrap"></div>
    <div id="banner-wrap" class="banner-wrap"></div>
    <div id="home-sections"></div>
  </main>
  <footer class="site-footer">
    <p>Trường Sa, Hoàng Sa là của Việt Nam!</p>
    <p class="footer-copyright">Copyright 2018 <a href="https://gotv.top" target="_blank" rel="noopener">GoTV</a>. All rights reserved.</p>
  </footer>
  <script src="/data/config/site-settings.json" type="application/json" id="site-settings-src"></script>
  <script src="/data/movies-light.js"></script>
  <script src="/data/filters.js"></script>
  <script src="/data/config/homepage-sections.json" type="application/json" id="homepage-sections-src"></script>
  <script src="/data/config/banners.json" type="application/json" id="banners-src"></script>
  <script>
    (function(){
      var base = '';
      window.DAOP = window.DAOP || {};
      window.DAOP.basePath = base;
      fetch(base + '/data/config/site-settings.json').then(function(r){ return r.json(); }).then(function(s){
        window.DAOP.siteName = s.site_name || 'DAOP Phim';
        window.DAOP.siteSettings = s;
        window.DAOP.supabaseUserUrl = s.supabase_user_url || '';
        window.DAOP.supabaseUserAnonKey = s.supabase_user_anon_key || '';
        window.DAOP.serverSources = [];
        fetch(base + '/data/config/server-sources.json').then(function(r){ return r.json(); }).then(function(arr){
          window.DAOP.serverSources = arr || [];
        }).catch(function(){});
      }).catch(function(){});
    })();
  </script>
  <script src="/js/main.js"></script>
  <script src="/js/user-sync.js"></script>
  <script>
    (function(){
      var base = window.DAOP && window.DAOP.basePath || '';
      function loadSectionsAndBanners(){
        return fetch(base + '/data/build_version.json').then(function(r){ return r.json(); }).catch(function(){ return {}; }).then(function(v){
          var ver = (v && v.builtAt) ? encodeURIComponent(v.builtAt) : '';
          var q = ver ? '?v=' + ver : '';
          return Promise.all([
            fetch(base + '/data/config/homepage-sections.json' + q).then(function(r){ return r.json(); }),
            fetch(base + '/data/config/banners.json' + q).then(function(r){ return r.json(); })
          ]);
        });
      }
      (window.DAOP && window.DAOP.siteSettings ? Promise.resolve() : fetch(base + '/data/config/site-settings.json').then(function(r){ return r.json(); }).then(function(s){ window.DAOP = window.DAOP || {}; window.DAOP.siteSettings = s; }))
        .then(loadSectionsAndBanners)
        .then(function(res){
        var sections = (res[0] && res[0].length) ? res[0] : [
          { title: 'Phim bộ', source_type: 'type', source_value: 'series', limit_count: 24, sort_order: 0, more_link: '/phim-bo.html' },
          { title: 'Phim lẻ', source_type: 'type', source_value: 'single', limit_count: 24, sort_order: 1, more_link: '/phim-le.html' },
          { title: 'Phim 4K', source_type: 'quality_4k', source_value: '', limit_count: 24, sort_order: 2, more_link: '/danh-sach/phim-4k.html' },
          { title: 'Thể loại (mẫu)', source_type: 'genre', source_value: 'hanh-dong', limit_count: 18, sort_order: 3, more_link: '/the-loai/' },
          { title: 'Quốc gia (mẫu)', source_type: 'country', source_value: 'au-my', limit_count: 18, sort_order: 4, more_link: '/quoc-gia/' },
          { title: 'Năm phát hành (mẫu)', source_type: 'year', source_value: '2024', limit_count: 18, sort_order: 5, more_link: '/nam-phat-hanh/' }
        ];
        var banners = res[1] || [];
        var fd = window.filtersData || {};
        var list = window.moviesLight || [];
        var bannerWrap = document.getElementById('banner-wrap');
        if (banners.length && bannerWrap) {
          var b = banners[0];
          bannerWrap.innerHTML = '<a href="' + (b.link_url || '#') + '"><img src="' + (b.image_url || '') + '" alt=""></a>';
        }
        var container = document.getElementById('home-sections');
        if (!container) return;
        sections.sort(function(a,b){ return (a.sort_order || 0) - (b.sort_order || 0); });
        var ss = window.DAOP && window.DAOP.siteSettings || {};
        sections.forEach(function(sec){
          var ids = [];
          if (sec.source_type === 'type' && fd.typeMap && fd.typeMap[sec.source_value]) ids = fd.typeMap[sec.source_value];
          else if (sec.source_type === 'genre' && fd.genreMap && fd.genreMap[sec.source_value]) ids = fd.genreMap[sec.source_value];
          else if (sec.source_type === 'country' && fd.countryMap && fd.countryMap[sec.source_value]) ids = fd.countryMap[sec.source_value];
          else if (sec.source_type === 'year' && fd.yearMap && fd.yearMap[sec.source_value]) ids = fd.yearMap[sec.source_value];
          else if (sec.source_type === 'status' && fd.statusMap && fd.statusMap[sec.source_value]) ids = fd.statusMap[sec.source_value];
          else if (sec.source_type === 'quality_4k' && fd.quality4kIds) ids = fd.quality4kIds;
          var limit = sec.limit_count || 24;
          var movies = ids.slice(0, limit).map(function(id){ return list.find(function(m){ return m.id === id; }); }).filter(Boolean);
          var moreLink = sec.more_link ? '<a href="' + sec.more_link + '">Xem thêm</a>' : '';
          var layout = (sec.display_type || 'grid').toLowerCase();
          var xs = [2,3,4,6,8].indexOf(Number(sec.grid_columns_xs)) >= 0 ? Number(sec.grid_columns_xs) : 2;
          var sm = [2,3,4,6,8].indexOf(Number(sec.grid_columns_sm)) >= 0 ? Number(sec.grid_columns_sm) : 3;
          var md = [2,3,4,6,8].indexOf(Number(sec.grid_columns_md)) >= 0 ? Number(sec.grid_columns_md) : 4;
          var lg = [2,3,4,6,8].indexOf(Number(sec.grid_columns_lg)) >= 0 ? Number(sec.grid_columns_lg) : 6;
          var gridVars = '--grid-cols-xs:' + xs + ';--grid-cols-sm:' + sm + ';--grid-cols-md:' + md + ';--grid-cols-lg:' + lg + ';';
          var usePoster = sec.use_poster === true || sec.use_poster === 'true' || ss.default_use_poster === 'true';
          var html = '<section class="home-section home-section-' + layout + (layout === 'grid' ? ' home-section--grid-cols' : '') + '"' + (layout === 'grid' ? ' style="' + gridVars + '"' : '') + '><h2>' + (sec.title || '') + ' ' + moreLink + '</h2>';
          if (layout === 'slider') {
            html += '<div class="section-slider-wrap"><div class="section-slider-track">';
            movies.forEach(function(m){ html += '<div class="section-slider-item">' + window.DAOP.renderMovieCard(m, base, { usePoster: usePoster }) + '</div>'; });
            html += '</div><button type="button" class="section-slider-prev" aria-label="Trước">‹</button><button type="button" class="section-slider-next" aria-label="Sau">›</button></div>';
          } else if (layout === 'list') {
            html += '<div class="movies-list">';
            movies.forEach(function(m){
              var href = base + '/phim/' + (m.slug || m.id) + '.html';
              var posterUrl = (usePoster ? (m.poster || m.thumb) : (m.thumb || m.poster) || '').replace(/^\/\//, 'https://') || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="120" height="168"%3E%3Crect fill="%2321262d" width="120" height="168"/%3E%3C/svg%3E';
              var title = (m.title || '').replace(/</g, '&lt;');
              var origin = (m.origin_name || '').replace(/</g, '&lt;');
              html += '<a href="' + href + '" class="movies-list-item"><span class="list-thumb"><img loading="lazy" src="' + posterUrl + '" alt=""></span><span class="list-info"><strong>' + title + '</strong>' + (origin ? '<em class="list-origin">' + origin + '</em>' : '') + (m.episode_current ? ' <span class="list-ep">• ' + m.episode_current + ' tập</span>' : '') + '</span></a>';
            });
            html += '</div>';
          } else {
            html += '<div class="movies-grid">';
            movies.forEach(function(m){ html += window.DAOP.renderMovieCard(m, base, { usePoster: usePoster }); });
            html += '</div>';
          }
          html += '</section>';
          container.insertAdjacentHTML('beforeend', html);
        });
        container.querySelectorAll('.section-slider-wrap').forEach(function(wrap){
          var track = wrap.querySelector('.section-slider-track');
          var prev = wrap.querySelector('.section-slider-prev');
          var next = wrap.querySelector('.section-slider-next');
          if (!track) return;
          var step = 220;
          if (prev) prev.addEventListener('click', function(){ track.scrollBy({ left: -step, behavior: 'smooth' }); });
          if (next) next.addEventListener('click', function(){ track.scrollBy({ left: step, behavior: 'smooth' }); });
        });
      }).catch(function(){});
    })();
  </script>
</body>
</html>
